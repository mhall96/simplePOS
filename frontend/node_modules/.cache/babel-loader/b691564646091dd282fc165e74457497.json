{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.setQuery = setQuery;\nexports.updateQueryOptions = updateQueryOptions;\nexports.logQuery = logQuery;\nexports.logCombinedQuery = logCombinedQuery;\nexports.setStreaming = setStreaming;\nexports.setHeaders = setHeaders;\nexports.setPromotedResults = setPromotedResults;\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\nexports.setQueryListener = setQueryListener;\n\nvar _constants = require('../constants');\n\nvar _value = require('./value');\n\nvar _hits = require('./hits');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nvar _constants2 = require('../../lib/utils/constants');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction setQuery(component, query) {\n  return {\n    type: _constants.SET_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction updateQueryOptions(component, options) {\n  return {\n    type: _constants.SET_QUERY_OPTIONS,\n    component: component,\n    options: options\n  };\n}\n\nfunction logQuery(component, query) {\n  return {\n    type: _constants.LOG_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction logCombinedQuery(component, query) {\n  return {\n    type: _constants.LOG_COMBINED_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction setLoading(component, isLoading) {\n  return {\n    type: _constants.SET_LOADING,\n    component: component,\n    isLoading: isLoading\n  };\n}\n\nfunction setError(component, error) {\n  return {\n    type: _constants.SET_ERROR,\n    component: component,\n    error: error\n  };\n}\n\nfunction setTimestamp(component, timestamp) {\n  return {\n    type: _constants.SET_TIMESTAMP,\n    component: component,\n    timestamp: timestamp\n  };\n}\n\nfunction setStreaming(component) {\n  var status = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return {\n    type: _constants.SET_STREAMING,\n    component: component,\n    status: status,\n    ref: ref\n  };\n}\n\nfunction setHeaders(headers) {\n  return {\n    type: _constants.SET_HEADERS,\n    headers: headers\n  };\n}\n\nfunction setPromotedResults() {\n  var results = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var component = arguments[1];\n  return {\n    type: _constants.SET_PROMOTED_RESULTS,\n    results: results,\n    component: component\n  };\n}\n\nfunction setSearchId() {\n  var searchId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  return {\n    type: _constants.SET_SEARCH_ID,\n    searchId: searchId\n  };\n}\n\nfunction setSuggestionsSearchId() {\n  var searchId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  return {\n    type: _constants.SET_SUGGESTIONS_SEARCH_ID,\n    searchId: searchId\n  };\n}\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var componentType = arguments[5];\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        appbaseRef = _getState.appbaseRef,\n        config = _getState.config,\n        headers = _getState.headers,\n        queryListener = _getState.queryListener,\n        analytics = _getState.analytics,\n        selectedValues = _getState.selectedValues;\n\n    var searchHeaders = {};\n    var suggestionsComponents = [_constants2.componentTypes.dataSearch, _constants2.componentTypes.categorySearch];\n    var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n\n    if (config.analytics) {\n      if (config.analyticsConfig.suggestionAnalytics && isSuggestionsQuery) {\n        var suggestionsSearchValue = analytics.suggestionsSearchValue;\n        var shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || suggestionsSearchValue);\n\n        if (shouldIncludeQuery) {\n          searchHeaders = {\n            'X-Search-Query': suggestionsSearchValue || ''\n          };\n        }\n      } else {\n        var searchValue = analytics.searchValue,\n            searchId = analytics.searchId;\n        var filterString = (0, _analytics2.default)(selectedValues);\n\n        if (searchId) {\n          searchHeaders = _extends({\n            'X-Search-Id': searchId,\n            'X-Search-Query': searchValue\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        } else {\n          var _shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || searchValue);\n\n          searchHeaders = _extends(_shouldIncludeQuery && {\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        }\n      }\n\n      if (config.analyticsConfig.searchStateHeader) {\n        var searchState = (0, _helper.getSearchState)(getState(), true);\n\n        if (searchState && Object.keys(searchState).length) {\n          searchHeaders['X-Search-State'] = JSON.stringify(searchState);\n        }\n      }\n\n      if (config.analyticsConfig.userId) {\n        searchHeaders['X-User-Id'] = config.analyticsConfig.userId;\n      }\n\n      if (config.analyticsConfig.customEvents) {\n        searchHeaders['X-Search-CustomEvent'] = (0, _analytics.parseCustomEvents)(config.analyticsConfig.customEvents);\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch(setLoading(component, true));\n    });\n\n    var handleTransformResponse = function handleTransformResponse(res, component) {\n      if (config.transformResponse && typeof config.transformResponse === 'function') {\n        return config.transformResponse(res, component);\n      }\n\n      return new Promise(function (resolve) {\n        return resolve(res);\n      });\n    };\n\n    var handleError = function handleError(error) {\n      console.error(error);\n      orderOfQueries.forEach(function (component) {\n        if (queryListener[component] && queryListener[component].onError) {\n          queryListener[component].onError(error);\n        }\n\n        dispatch(setError(component, error));\n        dispatch(setLoading(component, false));\n      });\n    };\n\n    var handleResponse = function handleResponse(res) {\n      var searchId = res._headers ? res._headers.get('X-Search-Id') : null;\n\n      if (searchId) {\n        if (isSuggestionsQuery) {\n          dispatch(setSuggestionsSearchId(searchId));\n        } else {\n          dispatch(setSearchId(searchId));\n        }\n      }\n\n      orderOfQueries.forEach(function (component, index) {\n        handleTransformResponse(res.responses[index], component).then(function (response) {\n          var _getState2 = getState(),\n              timestamp = _getState2.timestamp;\n\n          if (timestamp[component] === undefined || timestamp[component] < res._timestamp) {\n            var promotedResults = response.promoted || res.promoted;\n\n            if (promotedResults) {\n              dispatch(setPromotedResults(promotedResults, component));\n            } else {\n              dispatch(setPromotedResults([], component));\n            }\n\n            if (response.hits) {\n              dispatch(setTimestamp(component, res._timestamp));\n              dispatch((0, _hits.updateHits)(component, response.hits, response.took, appendToHits));\n              dispatch(setLoading(component, false));\n            }\n\n            if (response.aggregations) {\n              dispatch((0, _hits.updateAggs)(component, response.aggregations, appendToAggs));\n              dispatch((0, _hits.updateCompositeAggs)(component, response.aggregations, appendToAggs));\n            }\n          }\n        }).catch(function (err) {\n          handleError(err);\n        });\n      });\n    };\n\n    if (config.graphQLUrl) {\n      (0, _graphQL2.default)(config.graphQLUrl, config.url, config.credentials, config.app, query).then(function (res) {\n        handleResponse(res);\n      }).catch(function (err) {\n        handleError(err);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        handleResponse(res);\n      }).catch(function (err) {\n        handleError(err);\n      });\n    }\n  };\n}\n\nfunction executeQueryListener(listener, oldQuery, newQuery) {\n  if (listener && listener.onQueryChange) {\n    listener.onQueryChange(oldQuery, newQuery);\n  }\n}\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var componentType = arguments[3];\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        queryLog = _getState3.queryLog,\n        stream = _getState3.stream,\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        mapData = _getState3.mapData,\n        watchMan = _getState3.watchMan,\n        dependencyTree = _getState3.dependencyTree,\n        queryList = _getState3.queryList,\n        queryOptions = _getState3.queryOptions,\n        queryListener = _getState3.queryListener;\n\n    var orderOfQueries = [];\n    var finalQuery = [];\n    var matchAllQuery = {\n      match_all: {}\n    };\n    var componentList = [componentId];\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    componentList.forEach(function (component) {\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch(logQuery(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState4 = getState(),\n                combinedLog = _getState4.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch(logCombinedQuery(component, currentQuery));\n          }\n\n          executeQueryListener(queryListener[component], oldQuery, currentQuery);\n\n          if (stream[component] && stream[component].status) {\n            if (stream[component].ref) {\n              stream[component].ref.stop();\n            }\n\n            var ref = appbaseRef.searchStream({\n              type: config.type === '*' ? '' : config.type,\n              body: currentQuery\n            }, function (response) {\n              if (response._id) {\n                dispatch((0, _hits.pushToStreamHits)(component, response));\n              }\n            }, function (error) {\n              if (queryListener[component] && queryListener[component].onError) {\n                queryListener[component].onError(error);\n              }\n\n              console.warn(error);\n              dispatch(setError(component, error));\n              dispatch(setLoading(component, false));\n            });\n            dispatch(setStreaming(component, true, ref));\n          }\n\n          finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n            preference: component\n          }, currentQuery]);\n        }\n      }\n    });\n\n    if (finalQuery.length) {\n      dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal'), undefined, componentType));\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch(updateQueryOptions(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref) {\n  var componentId = _ref.componentId,\n      query = _ref.query,\n      value = _ref.value,\n      _ref$label = _ref.label,\n      label = _ref$label === undefined ? null : _ref$label,\n      _ref$showFilter = _ref.showFilter,\n      showFilter = _ref$showFilter === undefined ? true : _ref$showFilter,\n      _ref$URLParams = _ref.URLParams,\n      URLParams = _ref$URLParams === undefined ? false : _ref$URLParams,\n      _ref$componentType = _ref.componentType,\n      componentType = _ref$componentType === undefined ? null : _ref$componentType,\n      _ref$category = _ref.category,\n      category = _ref$category === undefined ? null : _ref$category;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category));\n    }\n\n    dispatch(setQuery(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true, false, componentType));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch(logQuery(component, currentQuery));\n    var finalQuery = [{\n      preference: component\n    }, currentQuery];\n    dispatch(msearch(finalQuery, [component], appendToHits, false, appendToAggs));\n  };\n}\n\nfunction setQueryListener(component, onQueryChange, onError) {\n  return {\n    type: _constants.SET_QUERY_LISTENER,\n    component: component,\n    onQueryChange: onQueryChange,\n    onError: onError\n  };\n}","map":{"version":3,"sources":["C:/Users/victoria/Documents/Project/simplePOS/frontend/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","setQuery","updateQueryOptions","logQuery","logCombinedQuery","setStreaming","setHeaders","setPromotedResults","executeQuery","setQueryOptions","updateQuery","loadMore","setQueryListener","_constants","require","_value","_hits","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","_constants2","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","arr2","from","component","query","type","SET_QUERY","options","SET_QUERY_OPTIONS","LOG_QUERY","LOG_COMBINED_QUERY","setLoading","isLoading","SET_LOADING","setError","error","SET_ERROR","setTimestamp","timestamp","SET_TIMESTAMP","status","undefined","ref","SET_STREAMING","headers","SET_HEADERS","results","SET_PROMOTED_RESULTS","setSearchId","searchId","SET_SEARCH_ID","setSuggestionsSearchId","SET_SUGGESTIONS_SEARCH_ID","msearch","orderOfQueries","appendToHits","isInternalComponent","appendToAggs","componentType","dispatch","getState","_getState","appbaseRef","config","queryListener","analytics","selectedValues","searchHeaders","suggestionsComponents","componentTypes","dataSearch","categorySearch","isSuggestionsQuery","indexOf","analyticsConfig","suggestionAnalytics","suggestionsSearchValue","shouldIncludeQuery","emptyQuery","searchValue","filterString","_shouldIncludeQuery","searchStateHeader","searchState","getSearchState","keys","JSON","stringify","userId","customEvents","parseCustomEvents","forEach","handleTransformResponse","res","transformResponse","Promise","resolve","handleError","console","onError","handleResponse","_headers","get","index","responses","then","response","_getState2","_timestamp","promotedResults","promoted","hits","updateHits","took","aggregations","updateAggs","updateCompositeAggs","catch","err","graphQLUrl","url","credentials","app","body","executeQueryListener","listener","oldQuery","newQuery","onQueryChange","componentId","executeWatchList","mustExecuteMapQuery","_getState3","queryLog","stream","mapData","watchMan","dependencyTree","queryList","queryOptions","finalQuery","matchAllQuery","match_all","componentList","watchList","concat","_buildQuery","buildQuery","queryObj","validOptions","some","item","includes","currentQuery","queryToLog","isEqual","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState4","combinedLog","stop","searchStream","_id","pushToStreamHits","warn","preference","endsWith","execute","_ref","_ref$label","label","_ref$showFilter","showFilter","_ref$URLParams","URLParams","_ref$componentType","_ref$category","category","queryToDispatch","setValue","newOptions","store","_buildQuery2","SET_QUERY_LISTENER"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.setQuery=setQuery;exports.updateQueryOptions=updateQueryOptions;exports.logQuery=logQuery;exports.logCombinedQuery=logCombinedQuery;exports.setStreaming=setStreaming;exports.setHeaders=setHeaders;exports.setPromotedResults=setPromotedResults;exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;exports.setQueryListener=setQueryListener;var _constants=require('../constants');var _value=require('./value');var _hits=require('./hits');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);var _constants2=require('../../lib/utils/constants');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function setQuery(component,query){return{type:_constants.SET_QUERY,component:component,query:query};}function updateQueryOptions(component,options){return{type:_constants.SET_QUERY_OPTIONS,component:component,options:options};}function logQuery(component,query){return{type:_constants.LOG_QUERY,component:component,query:query};}function logCombinedQuery(component,query){return{type:_constants.LOG_COMBINED_QUERY,component:component,query:query};}function setLoading(component,isLoading){return{type:_constants.SET_LOADING,component:component,isLoading:isLoading};}function setError(component,error){return{type:_constants.SET_ERROR,component:component,error:error};}function setTimestamp(component,timestamp){return{type:_constants.SET_TIMESTAMP,component:component,timestamp:timestamp};}function setStreaming(component){var status=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return{type:_constants.SET_STREAMING,component:component,status:status,ref:ref};}function setHeaders(headers){return{type:_constants.SET_HEADERS,headers:headers};}function setPromotedResults(){var results=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var component=arguments[1];return{type:_constants.SET_PROMOTED_RESULTS,results:results,component:component};}function setSearchId(){var searchId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return{type:_constants.SET_SEARCH_ID,searchId:searchId};}function setSuggestionsSearchId(){var searchId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return{type:_constants.SET_SUGGESTIONS_SEARCH_ID,searchId:searchId};}function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var componentType=arguments[5];return function(dispatch,getState){var _getState=getState(),appbaseRef=_getState.appbaseRef,config=_getState.config,headers=_getState.headers,queryListener=_getState.queryListener,analytics=_getState.analytics,selectedValues=_getState.selectedValues;var searchHeaders={};var suggestionsComponents=[_constants2.componentTypes.dataSearch,_constants2.componentTypes.categorySearch];var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;if(config.analytics){if(config.analyticsConfig.suggestionAnalytics&&isSuggestionsQuery){var suggestionsSearchValue=analytics.suggestionsSearchValue;var shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||suggestionsSearchValue);if(shouldIncludeQuery){searchHeaders={'X-Search-Query':suggestionsSearchValue||''};}}else{var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId,'X-Search-Query':searchValue},filterString&&{'X-Search-Filters':filterString});}else{var _shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||searchValue);searchHeaders=_extends(_shouldIncludeQuery&&{'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}}if(config.analyticsConfig.searchStateHeader){var searchState=(0,_helper.getSearchState)(getState(),true);if(searchState&&Object.keys(searchState).length){searchHeaders['X-Search-State']=JSON.stringify(searchState);}}if(config.analyticsConfig.userId){searchHeaders['X-User-Id']=config.analyticsConfig.userId;}if(config.analyticsConfig.customEvents){searchHeaders['X-Search-CustomEvent']=(0,_analytics.parseCustomEvents)(config.analyticsConfig.customEvents);}}orderOfQueries.forEach(function(component){dispatch(setLoading(component,true));});var handleTransformResponse=function handleTransformResponse(res,component){if(config.transformResponse&&typeof config.transformResponse==='function'){return config.transformResponse(res,component);}return new Promise(function(resolve){return resolve(res);});};var handleError=function handleError(error){console.error(error);orderOfQueries.forEach(function(component){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}dispatch(setError(component,error));dispatch(setLoading(component,false));});};var handleResponse=function handleResponse(res){var searchId=res._headers?res._headers.get('X-Search-Id'):null;if(searchId){if(isSuggestionsQuery){dispatch(setSuggestionsSearchId(searchId));}else{dispatch(setSearchId(searchId));}}orderOfQueries.forEach(function(component,index){handleTransformResponse(res.responses[index],component).then(function(response){var _getState2=getState(),timestamp=_getState2.timestamp;if(timestamp[component]===undefined||timestamp[component]<res._timestamp){var promotedResults=response.promoted||res.promoted;if(promotedResults){dispatch(setPromotedResults(promotedResults,component));}else{dispatch(setPromotedResults([],component));}if(response.hits){dispatch(setTimestamp(component,res._timestamp));dispatch((0,_hits.updateHits)(component,response.hits,response.took,appendToHits));dispatch(setLoading(component,false));}if(response.aggregations){dispatch((0,_hits.updateAggs)(component,response.aggregations,appendToAggs));dispatch((0,_hits.updateCompositeAggs)(component,response.aggregations,appendToAggs));}}}).catch(function(err){handleError(err);});});};if(config.graphQLUrl){(0,_graphQL2.default)(config.graphQLUrl,config.url,config.credentials,config.app,query).then(function(res){handleResponse(res);}).catch(function(err){handleError(err);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){handleResponse(res);}).catch(function(err){handleError(err);});}};}function executeQueryListener(listener,oldQuery,newQuery){if(listener&&listener.onQueryChange){listener.onQueryChange(oldQuery,newQuery);}}function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var componentType=arguments[3];return function(dispatch,getState){var _getState3=getState(),queryLog=_getState3.queryLog,stream=_getState3.stream,appbaseRef=_getState3.appbaseRef,config=_getState3.config,mapData=_getState3.mapData,watchMan=_getState3.watchMan,dependencyTree=_getState3.dependencyTree,queryList=_getState3.queryList,queryOptions=_getState3.queryOptions,queryListener=_getState3.queryListener;var orderOfQueries=[];var finalQuery=[];var matchAllQuery={match_all:{}};var componentList=[componentId];if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}componentList.forEach(function(component){var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch(logQuery(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState4=getState(),combinedLog=_getState4.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch(logCombinedQuery(component,currentQuery));}executeQueryListener(queryListener[component],oldQuery,currentQuery);if(stream[component]&&stream[component].status){if(stream[component].ref){stream[component].ref.stop();}var ref=appbaseRef.searchStream({type:config.type==='*'?'':config.type,body:currentQuery},function(response){if(response._id){dispatch((0,_hits.pushToStreamHits)(component,response));}},function(error){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}console.warn(error);dispatch(setError(component,error));dispatch(setLoading(component,false));});dispatch(setStreaming(component,true,ref));}finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:component},currentQuery]);}}});if(finalQuery.length){dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal'),undefined,componentType));}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch(updateQueryOptions(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref){var componentId=_ref.componentId,query=_ref.query,value=_ref.value,_ref$label=_ref.label,label=_ref$label===undefined?null:_ref$label,_ref$showFilter=_ref.showFilter,showFilter=_ref$showFilter===undefined?true:_ref$showFilter,_ref$URLParams=_ref.URLParams,URLParams=_ref$URLParams===undefined?false:_ref$URLParams,_ref$componentType=_ref.componentType,componentType=_ref$componentType===undefined?null:_ref$componentType,_ref$category=_ref.category,category=_ref$category===undefined?null:_ref$category;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category));}dispatch(setQuery(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true,false,componentType));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch(logQuery(component,currentQuery));var finalQuery=[{preference:component},currentQuery];dispatch(msearch(finalQuery,[component],appendToHits,false,appendToAggs));};}function setQueryListener(component,onQueryChange,onError){return{type:_constants.SET_QUERY_LISTENER,component:component,onQueryChange:onQueryChange,onError:onError};}"]},"metadata":{},"sourceType":"script"}